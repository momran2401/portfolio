<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radar FOV Visualizer | Mustafa Omran</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Three.js & Controls -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    colors: {
                        slate: {
                            850: '#151f32',
                            900: '#0f172a',
                            950: '#020617',
                        },
                        accent: {
                            cyan: '#06b6d4',
                            emerald: '#10b981',
                            rose: '#f43f5e'
                        }
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        /* Glassmorphism utilities */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .gradient-text {
            background: linear-gradient(to right, #22d3ee, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #canvas-container canvas {
            border-radius: 1rem;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 overflow-x-hidden selection:bg-cyan-500 selection:text-white">

    <!-- Background Ambient Effects -->
    <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-cyan-600/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-emerald-600/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 transition-all duration-300 glass-panel border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <a href="index.html" class="flex items-center space-x-3 group cursor-pointer">
               <span class="font-display font-bold text-xl tracking-tight text-white group-hover:text-cyan-400 transition-colors">
                   Mustafa Omran
               </span>
            </a>
            
            <div class="flex space-x-8 font-medium text-sm text-slate-400">
                <a href="index.html" class="flex items-center hover:text-white transition-colors py-2">
                    <i data-lucide="home" class="w-4 h-4 mr-2"></i>
                    Home
                </a>
                <a href="index.html#projects" class="flex items-center hover:text-white transition-colors py-2">
                    <i data-lucide="grid" class="w-4 h-4 mr-2"></i>
                    Portfolio
                </a>
            </div>
        </div>
    </nav>

    <main class="relative z-10 pt-32 pb-20">
        
        <!-- Header -->
        <section class="max-w-4xl mx-auto px-6 mb-12 text-center">
            <div data-aos="fade-down">
                <span class="px-3 py-1 text-xs font-bold text-cyan-400 bg-cyan-400/10 border border-cyan-400/20 rounded-full mb-4 inline-block">
                    Web Tool
                </span>
                <h1 class="font-display text-4xl md:text-6xl font-bold mb-6 tracking-tight leading-tight text-white">
                    Radar <span class="gradient-text">FOV Visualizer</span>
                </h1>
                <p class="text-xl text-slate-400 max-w-2xl mx-auto leading-relaxed">
                    Interactive 3D geometry calculator for determining radar field-of-view coverage.
                </p>
            </div>
        </section>

        <!-- Main Tool Interface -->
        <section class="max-w-7xl mx-auto px-6 mb-24">
            <div class="glass-panel rounded-3xl overflow-hidden border border-cyan-500/20 shadow-2xl shadow-cyan-500/10" data-aos="fade-up">
                <div class="grid lg:grid-cols-12">
                    
                    <!-- Controls Sidebar (4 cols) -->
                    <div class="lg:col-span-4 p-8 bg-slate-900/50 border-r border-white/5 flex flex-col h-[800px] overflow-y-auto">
                        <div class="flex items-center mb-6 pb-4 border-b border-white/5">
                            <div class="p-2 bg-cyan-500/10 rounded-lg text-cyan-400 mr-3">
                                <i data-lucide="sliders" class="w-5 h-5"></i>
                            </div>
                            <h2 class="text-lg font-bold text-white">Parameters</h2>
                        </div>
                        
                        <div class="space-y-6">
                            <!-- Radar Setup -->
                            <div>
                                <label class="text-xs font-bold text-cyan-400 uppercase tracking-wider mb-2 flex items-center">
                                    <i data-lucide="radio-tower" class="w-3 h-3 mr-1"></i> Radar Config
                                </label>
                                <div class="space-y-3">
                                    <div>
                                        <label class="text-xs text-slate-400">Height (Y)</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="range" id="radarHeight" min="0" max="200" value="20" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                                            <input type="number" id="radarHeightNum" value="20" class="w-16 bg-slate-800 border border-white/10 rounded px-2 py-1 text-xs text-white">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-xs text-slate-400">Tilt Angle (°)</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="range" id="tiltAngle" min="-90" max="90" value="10" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                                            <input type="number" id="tiltAngleNum" value="10" class="w-16 bg-slate-800 border border-white/10 rounded px-2 py-1 text-xs text-white">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-xs text-slate-400">Cone FOV (°)</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="range" id="coneFOV" min="1" max="120" value="40" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                                            <input type="number" id="coneFOVNum" value="40" class="w-16 bg-slate-800 border border-white/10 rounded px-2 py-1 text-xs text-white">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="border-white/5">

                            <!-- Object Position -->
                            <div>
                                <label class="text-xs font-bold text-emerald-400 uppercase tracking-wider mb-2 flex items-center">
                                    <i data-lucide="target" class="w-3 h-3 mr-1"></i> Target Position
                                </label>
                                <div class="grid grid-cols-3 gap-3">
                                    <div>
                                        <label class="text-xs text-slate-400 mb-1 block">Dist (X)</label>
                                        <input type="number" id="objectX" value="100" class="w-full bg-slate-800 border border-white/10 rounded px-3 py-2 text-sm text-white focus:border-cyan-500 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="text-xs text-slate-400 mb-1 block">Height (Y)</label>
                                        <input type="number" id="objectY" value="15" class="w-full bg-slate-800 border border-white/10 rounded px-3 py-2 text-sm text-white focus:border-cyan-500 focus:outline-none">
                                    </div>
                                    <div>
                                        <label class="text-xs text-slate-400 mb-1 block">Offset (Z)</label>
                                        <input type="number" id="objectZ" value="0" class="w-full bg-slate-800 border border-white/10 rounded px-3 py-2 text-sm text-white focus:border-cyan-500 focus:outline-none">
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label class="text-xs text-slate-500 flex items-center cursor-pointer">
                                        <input type="checkbox" id="mode3D" checked class="mr-2 rounded bg-slate-700 border-white/10 text-cyan-500 focus:ring-0">
                                        Enable 3D Calculation (Z-axis)
                                    </label>
                                </div>
                            </div>

                            <!-- Result Box -->
                            <div id="resultBox" class="mt-auto p-4 rounded-xl border transition-all duration-300">
                                <div class="flex items-center mb-2">
                                    <i id="statusIcon" data-lucide="help-circle" class="w-5 h-5 mr-2"></i>
                                    <span class="text-sm font-bold uppercase tracking-wider">Status</span>
                                </div>
                                <p id="statusText" class="text-lg font-bold">Calculating...</p>
                                <div class="mt-2 text-xs text-slate-400 font-mono space-y-1">
                                    <p>Angle Offset: <span id="debugAngle">0.00</span>°</p>
                                    <p>Direct Dist: <span id="debugDist">0.00</span>m</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3D Viewport (8 cols) -->
                    <div class="lg:col-span-8 relative h-[500px] lg:h-[800px] bg-gradient-to-b from-[#0b101b] to-[#02040a]" id="canvas-container">
                        
                        <!-- Overlay UI -->
                        <div class="absolute top-4 left-4 z-10 flex space-x-2">
                            <div class="bg-black/50 backdrop-blur-md px-3 py-1 rounded-full border border-white/10 text-xs text-slate-300 flex items-center">
                                <span class="w-2 h-2 bg-cyan-500 rounded-full mr-2"></span> Radar (0, H, 0)
                            </div>
                            <div class="bg-black/50 backdrop-blur-md px-3 py-1 rounded-full border border-white/10 text-xs text-slate-300 flex items-center">
                                <span class="w-2 h-2 bg-emerald-500 rounded-full mr-2"></span> Target (X, Y, Z)
                            </div>
                        </div>

                        <div class="absolute bottom-4 right-4 z-10 text-xs text-slate-500">
                            Left Click: Rotate • Right Click: Pan • Scroll: Zoom
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-black py-12 border-t border-white/10 mt-20">
            <div class="max-w-4xl mx-auto px-6 text-center">
                <a href="index.html" class="inline-flex items-center px-6 py-3 bg-slate-900 hover:bg-slate-800 border border-white/10 text-white rounded-lg transition-all font-medium">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                    Return to Portfolio
                </a>
                <div class="text-slate-600 text-sm mt-8">
                    <p>&copy; 2026 Mustafa Omran. Built with Tailwind & Coffee in Texas.</p>
                </div>
            </div>
        </footer>

    </main>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({ once: true, offset: 50, duration: 800 });
        lucide.createIcons();

        // --- Logic & 3D Visualization ---
        
        // Scene Setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x02040a, 0.002);

        const camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 2000);
        camera.position.set(50, 50, 150);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // Helpers
        const gridHelper = new THREE.GridHelper(400, 40, 0x1e293b, 0x0f172a);
        scene.add(gridHelper);
        const axesHelper = new THREE.AxesHelper(20);
        scene.add(axesHelper);

        // Lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(10, 20, 10);
        scene.add(dirLight);

        // Objects
        // 1. Radar Mesh (Base)
        const radarGeo = new THREE.CylinderGeometry(0, 2, 4, 8);
        const radarMat = new THREE.MeshLambertMaterial({ color: 0x06b6d4 });
        const radarMesh = new THREE.Mesh(radarGeo, radarMat);
        scene.add(radarMesh);

        // 2. Cone Mesh (Transparent FOV)
        // Note: ConeGeometry height aligns Y. We need to rotate it to point X, then apply Tilt.
        const coneHeight = 300; // Visual length
        const coneGeo = new THREE.ConeGeometry(1, coneHeight, 32, 1, true);
        coneGeo.translate(0, coneHeight / 2, 0); // Move base to origin
        coneGeo.rotateZ(-Math.PI / 2); // Point along +X
        
        const coneMat = new THREE.MeshBasicMaterial({ 
            color: 0x06b6d4, 
            transparent: true, 
            opacity: 0.15, 
            side: THREE.DoubleSide,
            depthWrite: false
        });
        const coneMesh = new THREE.Mesh(coneGeo, coneMat);
        scene.add(coneMesh);

        // Cone Edges for visibility
        const coneEdges = new THREE.LineSegments(
            new THREE.EdgesGeometry(coneGeo), 
            new THREE.LineBasicMaterial({ color: 0x06b6d4, transparent: true, opacity: 0.3 })
        );
        scene.add(coneEdges);

        // 3. Object (Target)
        const targetGeo = new THREE.SphereGeometry(3, 16, 16);
        const targetMat = new THREE.MeshLambertMaterial({ color: 0xffffff });
        const targetMesh = new THREE.Mesh(targetGeo, targetMat);
        scene.add(targetMesh);

        // 4. Line connecting Radar to Object
        const lineMat = new THREE.LineBasicMaterial({ color: 0x475569, dashSize: 2, gapSize: 1 });
        const lineGeo = new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0,0,0), new THREE.Vector3(0,0,0)]);
        const connLine = new THREE.Line(lineGeo, lineMat);
        scene.add(connLine);


        // --- State Management ---
        const inputs = {
            radarHeight: document.getElementById('radarHeight'),
            radarHeightNum: document.getElementById('radarHeightNum'),
            tiltAngle: document.getElementById('tiltAngle'),
            tiltAngleNum: document.getElementById('tiltAngleNum'),
            coneFOV: document.getElementById('coneFOV'),
            coneFOVNum: document.getElementById('coneFOVNum'),
            objectX: document.getElementById('objectX'),
            objectY: document.getElementById('objectY'),
            objectZ: document.getElementById('objectZ'),
            mode3D: document.getElementById('mode3D')
        };

        const ui = {
            resultBox: document.getElementById('resultBox'),
            statusText: document.getElementById('statusText'),
            statusIcon: document.getElementById('statusIcon'),
            debugAngle: document.getElementById('debugAngle'),
            debugDist: document.getElementById('debugDist')
        };

        function syncInputs(slider, num) {
            slider.addEventListener('input', () => { num.value = slider.value; update(); });
            num.addEventListener('input', () => { slider.value = num.value; update(); });
        }

        syncInputs(inputs.radarHeight, inputs.radarHeightNum);
        syncInputs(inputs.tiltAngle, inputs.tiltAngleNum);
        syncInputs(inputs.coneFOV, inputs.coneFOVNum);
        
        [inputs.objectX, inputs.objectY, inputs.objectZ, inputs.mode3D].forEach(el => {
            el.addEventListener('input', update);
        });


        // --- Update Logic ---
        function update() {
            // 1. Get Values
            const h = parseFloat(inputs.radarHeight.value);
            const tiltDeg = parseFloat(inputs.tiltAngle.value);
            const fovDeg = parseFloat(inputs.coneFOV.value);
            const x = parseFloat(inputs.objectX.value);
            const y = parseFloat(inputs.objectY.value);
            let z = parseFloat(inputs.objectZ.value);
            
            // 2D Mode Check
            if (!inputs.mode3D.checked) {
                z = 0;
                inputs.objectZ.disabled = true;
                inputs.objectZ.parentElement.classList.add('opacity-50');
            } else {
                inputs.objectZ.disabled = false;
                inputs.objectZ.parentElement.classList.remove('opacity-50');
            }

            // 2. Update 3D Positions
            radarMesh.position.set(0, h, 0);
            coneMesh.position.set(0, h, 0);
            coneEdges.position.set(0, h, 0);
            
            targetMesh.position.set(x, y, z);
            
            // Update Line
            const pts = [new THREE.Vector3(0, h, 0), new THREE.Vector3(x, y, z)];
            connLine.geometry.setFromPoints(pts);

            // 3. Update Cone Shape
            // Radius = height * tan(fov/2)
            const fovRad = fovDeg * (Math.PI / 180);
            const radius = coneHeight * Math.tan(fovRad / 2);
            coneMesh.scale.set(1, radius, radius); // X is height (length), Y/Z are radius
            coneEdges.scale.set(1, radius, radius);

            // 4. Update Cone Rotation (Tilt)
            // Default points +X. Tilt rotates around Z axis.
            const tiltRad = tiltDeg * (Math.PI / 180);
            coneMesh.rotation.set(0, 0, tiltRad);
            coneEdges.rotation.set(0, 0, tiltRad);

            // 5. Calculation Logic
            const radarPos = new THREE.Vector3(0, h, 0);
            const objPos = new THREE.Vector3(x, y, z);
            const dirVec = new THREE.Vector3(1, 0, 0);
            dirVec.applyAxisAngle(new THREE.Vector3(0, 0, 1), tiltRad); // Apply tilt to direction vector

            // Vector from Radar to Object
            const toObj = new THREE.Vector3().subVectors(objPos, radarPos);
            const dist = toObj.length();
            
            // Angle between Radar Direction and Object Vector
            const angleRad = toObj.angleTo(dirVec);
            const angleDeg = angleRad * (180 / Math.PI);

            const isInside = angleDeg <= (fovDeg / 2) && x > 0; // x>0 ensures in front

            // 6. Update UI
            ui.debugAngle.textContent = angleDeg.toFixed(2);
            ui.debugDist.textContent = dist.toFixed(2);

            if (isInside) {
                ui.resultBox.className = "mt-auto p-4 rounded-xl border transition-all duration-300 bg-emerald-500/10 border-emerald-500/50 text-emerald-400";
                ui.statusText.textContent = "DETECTED";
                ui.statusIcon.setAttribute('data-lucide', 'check-circle');
                targetMat.color.setHex(0x10b981); // Emerald
                targetMat.emissive.setHex(0x064e3b);
            } else {
                ui.resultBox.className = "mt-auto p-4 rounded-xl border transition-all duration-300 bg-rose-500/10 border-rose-500/50 text-rose-400";
                ui.statusText.textContent = "OUT OF RANGE";
                ui.statusIcon.setAttribute('data-lucide', 'x-circle');
                targetMat.color.setHex(0xf43f5e); // Rose
                targetMat.emissive.setHex(0x881337);
            }
            lucide.createIcons();
        }

        // Animation Loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Resize Handler
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });

        // Init
        update();
        animate();

    </script>
</body>
</html>
